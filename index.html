<!DOCTYPE html>

<link href="DataTables/datatables.min.css" rel="stylesheet">
 
<script src="DataTables/datatables.min.js"></script>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MapleRoyals Islander Ranking</title>
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="islander.css">

</head>
<body>

<h2 style="text-align: center;">MapleRoyals Islander Ranking</h2>

<div id="table-container"></div>

<script>

// Function to create and populate the table
function createTable(data) {
    const container = document.getElementById('table-container');
    const table = document.createElement('table');
    table.id = "myTable";
    table.classList.add('display');
    table.classList.add('mainTable');

    // Sort table by level descending
    data.sort((a, b) => {
        const valA = a["Level"];
        const valB = b["Level"];
        return valB - valA;
    });

    // Create table headers
    const headers = Object.keys(data[0]);
    const thead = document.createElement('thead');
    const headerRow = document.createElement('tr');
    let rank = 1;

    // Add calculated columns
    headers.unshift("Image2");
    headers.unshift("Rank");
    
    headers.forEach(header => {
        switch (header) {
            case "Rank":
            case "Image2": 
            case "Name":
            case "Level":
                 const th = document.createElement('th');
                 th.textContent = header.charAt(0).toUpperCase() + header.slice(1);
                 th.classList.add(header);
                 headerRow.appendChild(th);
                 break;
             default:
        }
    });

    thead.appendChild(headerRow);
    table.appendChild(thead);

    // Create table body
    const tbody = document.createElement('tbody');

    data.forEach(item => {
        const row = document.createElement('tr');
        
        headers.forEach(header => {
            const td = document.createElement('td');
            td.classList.add(header);

            switch (header) {
                case "Rank":
                    td.textContent = rank++;
                    row.appendChild(td);
                    break;
                case "Image2":
                    const img = document.createElement('img');
                    const baseName = item['Name'].toLowerCase();
                    const formats = ['png', 'gif', 'bmp','jpg','jpeg'];
                    let formatIndex = 0;

                    function tryLoadImage() {
                        if (formatIndex < formats.length) {
                            try {
                                img.src = `images/islanders/${baseName}.${formats[formatIndex]}`;
                            }
                            catch {

                            }
                            img.onerror = () => {
                                formatIndex++;
                                tryLoadImage(); // Try next format
                            };
                        } else {
                            img.onerror = null; // Prevent loop
                            img.src = 'images/placeholder.png'; // Fallback image
                        }
                    }

                    tryLoadImage();
                    td.appendChild(img);
                    row.appendChild(td);
                    break;
                case "Name":
                case "Level":
                     td.textContent = item[header];
                    row.appendChild(td);
                    break;
                default:
            }
        });
        tbody.appendChild(row);
    });

    table.appendChild(tbody);
    container.appendChild(table);

     $('#myTable').DataTable({
        pageLength: 20,
        layout: {
            topStart:'search',
            topEnd:'paging',
            bottomStart:'info',
            bottomEnd:'paging'
        }
     });
}

// Fetch JSON data and build table
fetch('islanders.json')
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        createTable(data);
    })
    .catch(error => {
        console.error('Error loading JSON:', error);
        document.getElementById('table-container').innerText = 'Failed to load data.';
    });
</script>

</body>
</html>
