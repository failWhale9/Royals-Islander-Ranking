<!DOCTYPE html>

<link href="DataTables/datatables.min.css" rel="stylesheet">
 
<script src="DataTables/datatables.min.js"></script>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MapleRoyals Islander Ranking</title>
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="islander.css">

</head>
<body>

<img src="images/title.png" id="titleImage"></img>

<div id="navbar">
    <a href=""><span class="navInactive"> Rankings </span></a>
    <a href="/badges.html"><span class="navActive"> Badges </span></a>
    <a href="/unranked.html"><span class="navActive"> Unranked Islanders </span></a>
</div>



<div class="scrolldiv">
    <label>Base item: </label> 
    <select id="itemBaseSelect" onchange="baseChange()">
        <option value ="gomu">White Gomushin</option>
        <option value ="stripeM">Blue One-Lined T-Shirt</option>
        <option value ="stripeF">Red Striped T-Shirt</option>
        <option value ="ice">Ice Jeans</option>
        <option value ="sweat">Grey Thick Sweat Pants</option>
    </select>

    <label>Character: </label>
    <select id="character" onchange="charChange()">
        <option value ="toben">Default</option>
        <option value ="namo">Namo</option>
        <option value ="lowly">Lowly</option>
        <option value ="mooshy">Mooshy</option>
    </select>
    <input type="submit" value="New Item" onclick="newItem()">
</div>

<!-- Inventory XY Values: 
 Top Left: 84,618
 Each X: +36
 Each Y: +34
 Shoe: 225,237
-->

<div class="scrollsim">
<img id="draggableImage" src="images/scroll/10.png" style="position:absolute; top:84px; left:618px;" draggable="true">
<img id="baseItem" src="images/scroll/gomu.png" style="position:absolute; top:225px; left:237px;">
<div id="dropZone" style="position:absolute; top:217px; left:237px; width:30px; height:30px;"></div>
<img id="char" src="/images/scroll/toben-neutral.gif" style="position:absolute; top:150px; left:442px; z-index: 9998;">
<img id="face" src="" style="position:absolute; top:152px; left:444px; z-index: 9999;">
<img id="scrollYes" src="" style="position:absolute; top:-10px; left:337px;">
<img id="scrollNo" src="" style="position:absolute; top:60px; left:413px;">
</div>




<div class="scrolldiv">
    <p>Stats:</p>
    <div>
        <span id="scrollStat">Scrolls Used:</span><span></span>
        <span id="scrollStat">Bases Used:</span><span></span>
        <span id="scrollStat">Best Result:</span><span></span>
    </div>
    <input type="submit" value="Reset Stats">
</div>


<img src="images/gomutest.jpg">


<div id="gomuBox" class="baseBox">
  <span style="color:#55ccff; padding-left:5px;">●</span> <span class="itemTitle">White Gomushin</span> <span id="itemTag" class="itemTitle">(+0)</span>
  <div class="baseTop">
    <div class="baseImgBox">
      <img class="baseImg "src="images/scroll/gomu.png">
    </div>
    <div class="baseStats">
      <ul style="list-style:none;padding-left:10px;margin-top:0px;">
        <li>REQ LV: 11</li>
        <li>REQ STR: 0</li>
        <li>REQ DEX: 0</li>
        <li>REQ INT: 0</li>
        <li>REQ LUK: 0</li>
        <li>REQ FAM: 0</li>
        <li style="color:#999999">ITEM LEV: -</li>
        <li style="color:#999999">ITEM EXP: -</li>
      </ul>
    </div>
  </div>
  <div style="clear: both;"></div>
  <img src="images/scroll/classes.png">
  <ul class="statList">
    <li>CATEGORY: SHOES</li>
    <li id="gomuDexLi">DEX: <span class="statValue">+</span><span id="gomuDex" class="statValue">0</span></li>
    <li id="gomuWdefLi">WEAPON DEF.: <span id="gomuWdef" class="statValue">9</span></li>
    <li id="gomuAccLi">ACCURACY: <span  class="statValue">+</span><span id="gomuAcc" class="statValue">0</span></li>
    <li id="gomuAvoLi">AVOIDABILITY: <span class="statValue">+</span><span id="gomuAvo" class="statValue">0</span></li>
    <li id="gomuSpdLi">SPEED: <span class="statValue">+</span><span id="gomuSpd" class="statValue">0</span></li>
    <li id="gomuJmpLi">JUMP: <span class="statValue">+</span><span id="gomuJmp" class="statValue">0</span></li>
    <li>NUMBER OF UPGRADES AVAILABLE: <span id="gomuSlt" class="statValue">0</span></li>
  </ul>
</div>

<div id="scrollBox" class="scrollBox">
  <span style="color:#55ccff; padding-left:5px;">●</span> <span class="itemTitle">Scroll for Shoes for Jump 10%</span>
  <div style="clear: both;"></div>
  <div class="baseImgBox" style="margin-left:10px;margin-top:5px;margin-bottom:18px;">
    <img class="baseImg "src="images/scroll/10.png" style="top:23px;">
  </div>
  <div class="scrollStats">
    <p>Improves jump on shoes.</p>
    <p>Success rate: 10%, jump +5,</p>
    <p>DEX+3, speed+1.</p>
  </div>
  <div style="clear: both;"></div>
</div>







<div id="footer">
    <p>Page written and maintained by <img src="/images/shy.png"></p> 
</div>

<script>

const image = document.getElementById("draggableImage");
const dropZone = document.getElementById("dropZone");

function baseChange() {

    // Clear item box
    // Populate inventory
    // Change equip view

    // Reset stats
    newItem();

}

function charChange() {

}

function getRandomInteger(min, max) {
  min = Math.ceil(min); // Ensure min is an integer
  max = Math.floor(max); // Ensure max is an integer
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

function newItem() {

    const baseType = document.getElementById("itemBaseSelect");

    switch(baseType.value) {
      case "gomu":
        let wdef = 0;
        let spd = 0;
        const gomuSpd = document.getElementById("gomuSpd");
        const gomuWdef = document.getElementById("gomuWdef");
        const gomuSlt = document.getElementById("gomuSlt");
        const gomuDexLi = document.getElementById("gomuDexLi");
        const gomuAccLi = document.getElementById("gomuAccLi");
        const gomuAvoLi = document.getElementById("gomuAvoLi");
        const gomuJmpLi = document.getElementById("gomuJmpLi");
        
        if(Math.random() >= 0.8) {
          wdef = getRandomInteger(3,10);
          spd = getRandomInteger(1,8);
        }
        else {
          wdef = getRandomInteger(3,5);
          spd = getRandomInteger(1,3);
        }
        console.log("wdef = " + wdef + "    spd = " + spd);
        gomuSpd.textContent = spd;
        gomuWdef.textContent = wdef;
        gomuSlt.textContent = "5";
        gomuDexLi.style.display = "none";
        gomuAccLi.style.display = "none";
        gomuAvoLi.style.display = "none";
        gomuJmpLi.style.display = "none";

        break;
      default:
        break;
    }

    // Roll for new item

    // Refresh item box
}

function shoeJump10() {
    // roll
    // update item box
}

// When drag starts, set data
image.addEventListener("dragstart", (e) => {
  e.dataTransfer.setData("text/plain", e.target.id); // optional: can set more specific info
});

// Allow drop on the dropZone
dropZone.addEventListener("dragover", (e) => {
  e.preventDefault(); // Necessary to allow dropping
});

// Handle drop
dropZone.addEventListener("drop", (e) => {
  e.preventDefault();
  const data = e.dataTransfer.getData("text/plain");

  console.log(data);

  // You can check if it's the correct image if needed
  if (data === "draggableImage") {
    // Trigger your custom function
    
    onImageDropped();
  }
});

function badResult()
{
  let sound = new Audio('/images/scroll/no.mp3');
  const noAnim = document.getElementById('scrollNo');
  const face = document.getElementById('face');
  sound.play();
  noAnim.style.display = 'block';
  noAnim.src = '';
  noAnim.src = 'images/scroll/no.gif';
  face.src ='/images/scroll/toben-smile.png';
  setTimeout(function() {
    face.src ='';
  }, 1000);
}

function goodResult()
{
  let sound = new Audio('/images/scroll/yes.mp3');
  const yesAnim = document.getElementById('scrollYes');
  const face = document.getElementById('face');
  sound.play();
  yesAnim.style.display = 'block';
  yesAnim.src = '';
  yesAnim.src = 'images/scroll/yes.gif';
  face.src ='/images/scroll/toben-smile.png';
  setTimeout(function() {
    face.src ='';
  }, 1000);
}


function onImageDropped() {
  if(Math.random() >= 0.9)
  {
    goodResult();
  }
  else
  {
    badResult();
  }
}

//Base Tooltip Code
const tooltip = document.getElementById('gomuBox'); // eventually replace with find-all
const hoverable = document.getElementById('dropZone');

hoverable.addEventListener('mouseenter', () => {
    const rect = hoverable.getBoundingClientRect();
    tooltip.style.top = `${rect.bottom + 8}px`;
    tooltip.style.left = `${rect.left}px`;
    void tooltip.offsetWidth;
    tooltip.classList.add('visible');
});

hoverable.addEventListener('mouseleave', () => {
  tooltip.classList.remove('visible');
});

// todo:
// mouse pointer
// random emotes
// image box hover
// scroll box hover
// Sound effect for new item button (click?)
// extend background so item doesn't escape

</script>
</body>
</html>