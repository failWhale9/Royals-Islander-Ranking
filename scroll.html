<!DOCTYPE html>

<link href="DataTables/datatables.min.css" rel="stylesheet">
 
<script src="DataTables/datatables.min.js"></script>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MapleRoyals Islander Ranking</title>
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="islander.css">

</head>
<body>

<img src="images/title.png" id="titleImage"></img>

<div id="navbar">
    <a href=""><span class="navInactive"> Rankings </span></a>
    <a href="/badges.html"><span class="navActive"> Badges </span></a>
    <a href="/unranked.html"><span class="navActive"> Unranked Islanders </span></a>
</div>



<div class="scrolldiv">
    <label>Base item: </label> 
    <select id="itemBaseSelect" onchange="baseChange(event)">
        <option value ="none">-------------</option>
        <option value ="gomu">White Gomushin</option>
        <option value ="stripeM">Blue One-Lined T-Shirt</option>
        <option value ="stripeF">Red Striped T-Shirt</option>
        <option value ="ice">Ice Jeans</option>
        <option value ="sweat">Grey Thick Sweat Pants</option>
    </select>

    <label>Character: </label>
    <select id="character" onchange="charChange()">
        <option value ="toben">Default</option>
        <option value ="namo">Namo</option>
        <option value ="lowly">Lowly</option>
        <option value ="mooshy">Mooshy</option>
    </select>
    <input type="submit" value="New Item" onclick="newItem()">
</div>

<!-- Inventory XY Values: 
 Top Left: 84,618
 Each X: +36
 Each Y: +34
 Shoe: 225,237
-->

<div class="scrollsim">
<!-- Scrolls -->
<img id="shoejmp10" class="draggableImage hoverscroll" src="images/scroll/10.png" style="display:none; position:absolute; top:84px; left:618px;" draggable="true" data-title="Scroll for Shoes for Jump 10%" data-desc1="Improves jump on shoes." data-desc2="Success rate: 10%, jump +5," data-desc3="DEX+3, speed+1.">
<img id="shoedex10" class="draggableImage hoverscroll" src="images/scroll/10.png" style="display:none; position:absolute; top:84px; left:654px;" draggable="true" data-title="Scroll for Shoes for DEX 10%" data-desc1="Improves dexterity on shoes." data-desc2="Success rate: 10%, Avoidability" data-desc3="+5, accuraccy +3, speed+1">
<img id="topdef10" class="draggableImage hoverscroll" src="images/scroll/10.png" style="display:none; position:absolute; top:84px; left:618px;" draggable="true" data-title="Scroll for Topwear for DEF 10%" data-desc1="Improves weapon def. on topwear." data-desc2="Success rate:10%, weapon def. +5," data-desc3="magic def. +3, MaxHP+10.">
<img id="botdef10" class="draggableImage hoverscroll" src="images/scroll/10.png" style="display:none; position:absolute; top:84px; left:618px;" draggable="true" data-title="Scroll for Bottomwear for DEF 10%" data-desc1="Improves weapon def. on the bottomwear." data-desc2="Success rate:10%, weapon def.+5," data-desc3="magic def.+3, MaxHP+10.">

<!-- Bases -->
<img id="gomu" class="dropZone activeBase" src="images/scroll/gomu.png" style="display:none; position:absolute; top:225px; left:237px;">
<img id="stripeM" class="dropZone" src="images/scroll/stripeM.png" style="display:none; position:absolute; top:154px; left:203px;">
<img id="stripeF" class="dropZone" src="images/scroll/stripeF.png" style="display:none; position:absolute; top:155px; left:205px;">
<img id="ice" class="dropZone" src="images/scroll/ice.png" style="display:none; position:absolute; top:184px; left:206px;">
<img id="sweat" class="dropZone" src="images/scroll/sweat.png" style="display:none; position:absolute; top:186px; left:207px;">
<img id="char" src="/images/scroll/toben-neutral.gif" style="position:absolute; top:150px; left:442px; z-index: 9998;">
<img id="face" src="" style="position:absolute; top:152px; left:444px; z-index: 9999;">
<img id="scrollYes" src="" style="position:absolute; top:-10px; left:337px;">
<img id="scrollNo" src="" style="position:absolute; top:60px; left:413px;">
</div>




<div class="scrolldiv">
    <p>Stats:</p>
    <div>
        <span id="scrollStat">Scrolls Used:</span><span id="scrollStatValue">0</span>
        <span id="scrollStat">Bases Used:</span><span id="scrollStatValue">0</span>
        <span id="scrollStat">Best Result:</span><span id="scrollStatValue">N/A</span>
    </div>
    <input type="submit" value="Reset Stats">
</div>


<div id="stripeMBox" class="baseBox">
  <span style="color:#55ccff; padding-left:5px;">●</span> <span class="itemTitle">Blue One-Lined T-Shirt</span> <span id="stripeMTag" class="itemTitle">(+0)</span>
  <div class="baseTop">
    <div class="baseImgBox">
      <img class="baseImg "src="images/scroll/stripeM.png" style="top:22px;">
    </div>
    <div class="baseStats">
      <ul style="list-style:none;padding-left:10px;margin-top:0px;">
        <li>REQ LV: 11</li>
        <li>REQ STR: 0</li>
        <li>REQ DEX: 0</li>
        <li>REQ INT: 0</li>
        <li>REQ LUK: 0</li>
        <li>REQ FAM: 0</li>
        <li style="color:#999999">ITEM LEV: -</li>
        <li style="color:#999999">ITEM EXP: -</li>
      </ul>
    </div>
  </div>
  <div style="clear: both;"></div>
  <img src="images/scroll/classes.png">
  <ul class="statList">
    <li>CATEGORY: TOP</li>
    <li id="stripeMHpLi">HP: <span class="statValue">+</span><span id="stripeMHp" class="statValue">0</span></li>
    <li id="stripeMWdefLi">WEAPON DEF: <span id="stripeMWdef" class="statValue">0</span></li>
    <li id="stripeMMdefLi">MAGIC DEF: <span id="stripeMMdef" class="statValue">0</span></li>
    <li>NUMBER OF UPGRADES AVAILABLE: <span id="stripeMSlt" class="statValue">0</span></li>
  </ul>
</div>


<div id="gomuBox" class="baseBox">
  <span style="color:#55ccff; padding-left:5px;">●</span> <span class="itemTitle">White Gomushin</span> <span id="gomuTag" class="itemTitle">(+0)</span>
  <div class="baseTop">
    <div class="baseImgBox">
      <img class="baseImg "src="images/scroll/gomu.png">
    </div>
    <div class="baseStats">
      <ul style="list-style:none;padding-left:10px;margin-top:0px;">
        <li>REQ LV: 11</li>
        <li>REQ STR: 0</li>
        <li>REQ DEX: 0</li>
        <li>REQ INT: 0</li>
        <li>REQ LUK: 0</li>
        <li>REQ FAM: 0</li>
        <li style="color:#999999">ITEM LEV: -</li>
        <li style="color:#999999">ITEM EXP: -</li>
      </ul>
    </div>
  </div>
  <div style="clear: both;"></div>
  <img src="images/scroll/classes.png">
  <ul class="statList">
    <li>CATEGORY: SHOES</li>
    <li id="gomuDexLi">DEX: <span class="statValue">+</span><span id="gomuDex" class="statValue">0</span></li>
    <li id="gomuWdefLi">WEAPON DEF.: <span id="gomuWdef" class="statValue">0</span></li>
    <li id="gomuAccLi">ACCURACY: <span  class="statValue">+</span><span id="gomuAcc" class="statValue">0</span></li>
    <li id="gomuAvoLi">AVOIDABILITY: <span class="statValue">+</span><span id="gomuAvo" class="statValue">0</span></li>
    <li id="gomuSpdLi">SPEED: <span class="statValue">+</span><span id="gomuSpd" class="statValue">0</span></li>
    <li id="gomuJmpLi">JUMP: <span class="statValue">+</span><span id="gomuJmp" class="statValue">0</span></li>
    <li>NUMBER OF UPGRADES AVAILABLE: <span id="gomuSlt" class="statValue">0</span></li>
  </ul>
</div>

<div id="scrollBox" class="scrollBox">
  <span style="color:#55ccff; padding-left:5px;">●</span> <span id="scrolltipTitle" class="itemTitle">Scroll for Shoes for Jump 10%</span>
  <div style="clear: both;"></div>
  <div class="baseImgBox" style="margin-left:10px;margin-top:5px;margin-bottom:18px;">
    <img class="baseImg "src="images/scroll/10.png" style="top:23px;">
  </div>
  <div class="scrollStats">
    <p id="scrolltipDesc1">Improves jump on shoes.</p>
    <p id="scrolltipDesc2">Success rate: 10%, jump +5,</p>
    <p id="scrolltipDesc3">DEX+3, speed+1.</p>
  </div>
  <div style="clear: both;"></div>
</div>

<div id="footer">
    <p>Page written and maintained by <img src="/images/shy.png"></p> 
</div>

<script>

const draggables = document.querySelectorAll('.draggableImage');
const dropZone = document.querySelectorAll('.dropZone');

// When drag starts, set data
draggables.forEach(draggable => {
  draggable.addEventListener("dragstart", (e) => {
    let sound = new Audio('/images/scroll/DragStart.mp3');
    sound.play();
    e.dataTransfer.setData("text/plain", e.target.id);
  });
});

dropZone.forEach(zone => {

  zone.addEventListener("dragover",(e) => {
    e.preventDefault();
  });

  zone.addEventListener("drop", (e) => {
    e.preventDefault();
    const scrollType = e.dataTransfer.getData("text/plain");
    scrollActivated(scrollType, zone.id);
});

});

function updateTag(tag) {
  if (tag.textContent == "") {
    tag.textContent = "(+1)";
  }
  else {
    tag.textContent = "(+" + (parseInt(tag.textContent[2]) + 1) + ")";
  }
}

function scrollActivated(scrollType, baseType) {

  //const baseEle = document.getElementById(baseType);
  let slots = document.getElementById(baseType + "Slt");
  console.log(baseType);
  console.log(slots);
  if(parseInt(slots.textContent) <= 0) {
    // make sound?
    return;
  }

  switch(scrollType) {
    case "shoejmp10": {
      const spd = document.getElementById(baseType + "Spd");
      const jmp = document.getElementById(baseType + "Jmp");
      const dex = document.getElementById(baseType + "Dex");
      const dexLi = document.getElementById(baseType + "DexLi");
      const jmpLi = document.getElementById(baseType + "JmpLi");
      const gomuTag = document.getElementById("gomuTag");
      if(Math.random() >= 0.9) {
        goodResult();
        dexLi.style.display = "block";
        jmpLi.style.display = "block";
        spd.textContent = parseInt(spd.textContent) + 1;
        jmp.textContent = parseInt(jmp.textContent) + 5;
        dex.textContent = parseInt(dex.textContent) + 3;
        slots.textContent = parseInt(slots.textContent) - 1;
        updateTag(gomuTag);
      }
      else {
        badResult();
        slots.textContent = parseInt(slots.textContent) - 1;
      }
      break;
    }
    case "shoedex10": {
      const spd = document.getElementById(baseType + "Spd");
      const acc = document.getElementById(baseType + "Acc");
      const avo = document.getElementById(baseType + "Avo");
      const accLi = document.getElementById(baseType + "AccLi");
      const avoLi = document.getElementById(baseType + "AvoLi");
      const gomuTag = document.getElementById("gomuTag");
     if(Math.random() >= 0.9) {
        goodResult();
        accLi.style.display = "block";
        avoLi.style.display = "block";
        spd.textContent = parseInt(spd.textContent) + 1;
        avo.textContent = parseInt(avo.textContent) + 5;
        acc.textContent = parseInt(acc.textContent) + 3;
        slots.textContent = parseInt(slots.textContent) - 1;
        updateTag(gomuTag);
      }
      else {
        badResult();
        slots.textContent = parseInt(slots.textContent) - 1;
      }
      break;
    }
    case "topdef10": {
      const wdef = document.getElementById(baseType + "Wdef");
      const mdef = document.getElementById(baseType + "Mdef");
      const hp = document.getElementById(baseType + "Hp");
      const mdefLi = document.getElementById(baseType + "MdefLi");
      const hpLi = document.getElementById(baseType + "HpLi");
      const tag = document.getElementById(baseType + "Tag");
      if(Math.random() >= 0.9) {
        goodResult();
        mdefLi.style.display = "block";
        hpLi.style.display = "block";
        wdef.textContent = parseInt(wdef.textContent) + 5;
        mdef.textContent = parseInt(mdef.textContent) + 3;
        hp.textContent = parseInt(hp.textContent) + 10;
        slots.textContent = parseInt(slots.textContent) - 1;
        updateTag(tag);
      }
      else {
        badResult();
        slots.textContent = parseInt(slots.textContent) - 1;
      }
      break;
    }
    default:
      break;
  }
}

function baseChange(event) {

    // Clear scrolls and bases
    const scrolls = document.querySelectorAll('.hoverscroll');
    const bases = document.querySelectorAll('.dropZone');
    scrolls.forEach(scroll => {
      scroll.style.display = "none";
    });
    bases.forEach(base => {
      base.style.display = "none";
      base.classList.remove("activeBase");
    });

    // Populate inventory
    switch(event.target.value) {
      case "gomu": {
        const shoejmp10 = document.getElementById("shoejmp10");
        const shoedex10 = document.getElementById("shoedex10");
        const gomu = document.getElementById("gomu");
        shoejmp10.style.display = "block";
        shoedex10.style.display = "block";
        gomu.style.display = "block";
        gomu.classList.add("activeBase");
        break;
      }
      case "stripeM": {
          const topdef10 = document.getElementById("topdef10");
          const stripeM = document.getElementById("stripeM");
          topdef10.style.display = "block";
          stripeM.style.display = "block";
          stripeM.classList.add("activeBase");
        break;
      }
      case "stripeF": {
          const topdef10 = document.getElementById("topdef10");
          const stripeF = document.getElementById("stripeF");
          topdef10.style.display = "block";
          stripeF.style.display = "block";
          stripeF.classList.add("activeBase");
        break;
      }
      case "ice": {
          const botdef10 = document.getElementById("botdef10");
          const ice = document.getElementById("ice");
          botdef10.style.display = "block";
          ice.style.display = "block";
          ice.classList.add("activeBase");
        break;
      }
      case "sweat": {
          const botdef10 = document.getElementById("botdef10");
          const sweat = document.getElementById("sweat");
          botdef10.style.display = "block";
          sweat.style.display = "block";
          sweat.classList.add("activeBase");
        break;
      }
    }

    // Reset stats
    newItem();

}

function charChange() {

}

function getRandomInteger(min, max) {
  min = Math.ceil(min); // Ensure min is an integer
  max = Math.floor(max); // Ensure max is an integer
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

function newItem() {

    const baseType = document.getElementById("itemBaseSelect");
    let sound = new Audio('/images/scroll/NewBase.mp3');
    sound.play();

    switch(baseType.value) {
      case "gomu": {
        let wdef = 0;
        let spd = 0;
        const gomuSpd = document.getElementById("gomuSpd");
        const gomuWdef = document.getElementById("gomuWdef");
        const gomuJmp = document.getElementById("gomuJmp");
        const gomuDex = document.getElementById("gomuDex");
        const gomuAcc = document.getElementById("gomuAcc");
        const gomuAvo = document.getElementById("gomuAvo");
        const gomuSlt = document.getElementById("gomuSlt");
        const gomuDexLi = document.getElementById("gomuDexLi");
        const gomuAccLi = document.getElementById("gomuAccLi");
        const gomuAvoLi = document.getElementById("gomuAvoLi");
        const gomuJmpLi = document.getElementById("gomuJmpLi");
        const gomuTag = document.getElementById("gomuTag");
        
        if(Math.random() >= 0.8) {
          wdef = getRandomInteger(3,10);
          spd = getRandomInteger(1,8);
        }
        else {
          wdef = getRandomInteger(3,5);
          spd = getRandomInteger(1,3);
        }
        gomuSpd.textContent = spd;
        gomuWdef.textContent = wdef;
        gomuJmp.textContent = "0";
        gomuDex.textContent = "0";
        gomuAcc.textContent = "0";
        gomuAvo.textContent = "0";
        gomuSlt.textContent = "5";
        gomuTag.textContent = "";
        gomuDexLi.style.display = "none";
        gomuAccLi.style.display = "none";
        gomuAvoLi.style.display = "none";
        gomuJmpLi.style.display = "none";
        break;
      }
      case "stripeM": {
        let wdef = 0;
        let mdef = 0;
        let hp = 0;
        const stripeMWdef = document.getElementById("stripeMWdef");
        const stripeMMdef = document.getElementById("stripeMMdef");
        const stripeMHp = document.getElementById("stripeMHp");
        const stripeMSlt = document.getElementById("stripeMSlt");
        const stripeMMdefLi = document.getElementById("stripeMMdefLi");
        const stripeMHpLi = document.getElementById("stripeMHpLi");
        const stripeMTag = document.getElementById("stripeMTag");
        if(Math.random() >= 0.8) {
          wdef = getRandomInteger(9,18);
        }
        else {
          wdef = getRandomInteger(9,13);
        }
        stripeMWdef.textContent = wdef;
        stripeMMdef.textContent = "0";
        stripeMHp.textContent = "0";
        stripeMSlt.textContent = "7";
        stripeMTag.textContent = "";
        stripeMMdefLi.style.display = "none";
        stripeMHpLi.style.display = "none";
        break;
      }
      default:
        break;
    }
}

function badResult()
{
  let sound = new Audio('/images/scroll/no.mp3');
  const noAnim = document.getElementById('scrollNo');
  const face = document.getElementById('face');
  sound.play();
  noAnim.style.display = 'block';
  noAnim.src = '';
  noAnim.src = 'images/scroll/no.gif';
  face.src ='/images/scroll/toben-smile.png';
  setTimeout(function() {
    face.src ='';
  }, 1000);
}

function goodResult()
{
  let sound = new Audio('/images/scroll/yes.mp3');
  const yesAnim = document.getElementById('scrollYes');
  const face = document.getElementById('face');
  sound.play();
  yesAnim.style.display = 'block';
  yesAnim.src = '';
  yesAnim.src = 'images/scroll/yes.gif';
  face.src ='/images/scroll/toben-smile.png';
  setTimeout(function() {
    face.src ='';
  }, 1000);
}

//Base Tooltip Code
const baseBoxes = document.querySelectorAll('.baseBox');
const bases = document.querySelectorAll('.dropZone');

bases.forEach(base => {
  let baseBoxID = base.id + "Box";
  let baseBox = document.getElementById(baseBoxID);
  base.addEventListener('mouseenter', () => {
    const rect = base.getBoundingClientRect();
    baseBox.style.top = `${rect.bottom - 42}px`;
    baseBox.style.left = `${rect.left}px`;
    void baseBox.offsetWidth;
    baseBox.classList.add('visible');
  });

  base.addEventListener('mouseleave', () => {
    baseBox.classList.remove('visible');
  });
});

// Scroll Tooltip Code
const scrolltip = document.getElementById('scrollBox');
const scrolltipTitle = document.getElementById('scrolltipTitle');
const scrolltipDesc1 = document.getElementById('scrolltipDesc1');
const scrolltipDesc2 = document.getElementById('scrolltipDesc2');
const scrolltipDesc3 = document.getElementById('scrolltipDesc3');
const hoverscrolls = document.querySelectorAll('.hoverscroll');

hoverscrolls.forEach(container => {
    container.addEventListener('mouseenter', () => {
      const rect = container.getBoundingClientRect();
      scrolltip.style.top = `${rect.bottom + 8}px`;
      scrolltip.style.left = `${rect.left}px`;
      scrolltipTitle.textContent = container.dataset.title;
      scrolltipDesc1.textContent = container.dataset.desc1;
      scrolltipDesc2.textContent = container.dataset.desc2;
      scrolltipDesc3.textContent = container.dataset.desc3;
      void scrolltip.offsetWidth;
      scrolltip.classList.add('visible');
    });

    container.addEventListener('mouseleave', () => {
      scrolltip.classList.remove('visible');
    });
});

// Anticheat code
const antiCheat = (mutationsList, observer) => {
  for (const mutation of mutationsList) {
    if(mutation.type == "characterData") {
      if(mutation.target.parentElement.nodeName != "BODY") {
        let sound = new Audio('/images/scroll/cheat.mp3');
        sound.play();
        mutation.target.parentElement.textContent = "CHEATER!";
      }
    } 
  }
}

const observer = new MutationObserver(antiCheat);
let obsconfig = {
  childList: true,
  subtree: true,
  characterData: true
}
observer.observe(document.body,obsconfig);



// todo:
// mouse pointer
// random emotes
// background music
// stats
// item tag colors?
// cheat clown

</script>
</body>
</html>